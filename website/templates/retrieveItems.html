{% extends "base.html" %}
{% block title %}Library Loan System - Retrieve Users{% endblock %}

{% block content %}
<section class="section-content padding-y">
<div class="container px-4 px-lg-5 mt-5">
  

  <h1 class="display-4">Retrieve Items</h1>
  <div>
    {% if count == 0 %}
    <p>There are no items.</p>
    {% elif count == 1 %}
    <p>There is 1 item.</p>
    {% else %}
    <p>There are {{ count }} items.</p>
    {% endif %}
  </div>
  <div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Count ID</th>
          <th>UUID</th>
          <th>Name</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Owner</th>
          <th><a href="/AddItemForm" class="btn btn-primary">Add Item</a></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for item in items_list %}
      <tr>
          <td>{{ item.get_count_id() }}</td>
          <td>{{ item.get_id() }}</td>
          <td>{{ item.get_name() }}</td>
          <td>{{ item.get_quantity() }}</td>
          <td>{{ item.get_price() }}</td>
          <td>{{ item.get_owner() }}</td>
          <td><a href="/updateItem/{{ item.get_id() }}" class="btn btn-warning">Update</a></td>
          <td>
            <form action="{{url_for('delete_item', id=item.get_id())}}" method="POST">
  <!-- Button to Open the Modal -->
  <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal_{{item.get_id()}}">
    Delete
  </button>

  <!-- The Modal -->
  <div class="modal" id="myModal_{{item.get_id()}}">
    <div class="modal-dialog">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Delete Confirmation</h4>
          <button type="button" class="btn-close" data-dismiss="modal"></button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          Are you sure you want to delete?
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <input type="submit" value="Delete" class="btn btn-danger">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>

      </div>
    </div>
  </div>
            </form>
          </td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
</div>


<!--csv section-->
<div class="container mt-5">
  <h1>CSV Viewer</h1>
  <div class="form-group">
    <input type="file" id="csv-file" accept=".csv" class="form-control-file">
  </div>
  <div class="form-group">
    <button id="load-button" class="btn btn-primary">Load CSV</button>
    <button id="clear-button" class="btn btn-secondary" disabled>Clear</button>
    <a id="download-button" class="btn btn-secondary" download disabled>Download</a>
  </div>
  <div id="output" class="table-responsive mt-5">
    <table class="table">
    </table>
  </div>
</div>
<script>
  const loadButton = document.getElementById('load-button');
const clearButton = document.getElementById('clear-button');
const downloadButton = document.getElementById('download-button');
const csvFileInput = document.getElementById('csv-file');
const outputDiv = document.getElementById('output');
const table = outputDiv.querySelector('table');

loadButton.addEventListener('click', () => {
// Read the contents of the CSV file
const reader = new FileReader();
reader.onload = (event) => {
  // Split the contents of the file into lines
  const lines = event.target.result.split('\n');
  // Iterate through the lines and create table rows
  lines.forEach((line) => {
    const cells = line.split(',');
    const row = document.createElement('tr');
    cells.forEach((cell) => {
      const td = document.createElement('td');
      td.textContent = cell;
      row.appendChild(td);
    });
    table.appendChild(row);
  });
  // Enable the clear and download buttons
  clearButton.disabled = false;
  downloadButton.disabled = false;
};
reader.readAsText(csvFileInput.files[0]);
});

clearButton.addEventListener('click', () => {
// Remove all the table rows from the output div
while (table.firstChild) {
  table.removeChild(table.firstChild);
}
// Disable the clear and download buttons
clearButton.disabled = true;
downloadButton.disabled = true;
});

downloadButton.addEventListener('click', () => {
// Get the contents of the table as a CSV string
const rows = Array.from(table.querySelectorAll('tr'));
const csv = rows.map((row) => {
  const cells = Array.from(row.querySelectorAll('td'));
  return cells.map((cell) => cell.textContent).join(',');
}).join('\n');

// Create a Blob object with the CSV string as the contents
const blob = new Blob([csv], { type: 'text/csv' });

// Create a URL for the exported file
const url = URL.createObjectURL(blob);

// Set the href and download attributes of the download button
downloadButton.href = url;
downloadButton.download = 'exported.csv';
});
</script>
{% endblock %}
